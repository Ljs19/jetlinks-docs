# 通知管理

通知管理用于统一管理、维护各种消息通知配置以及模版。可在场景联动的执行动作中被引用，也可通过统一的接口发送短信、邮件、微信消息、钉钉消息等消息通知。
支持的**通知方式**：

| 通知方式 | 类型                                     |
| -------- | ---------------------------------------- |
| 钉钉     | 钉钉消息群机器人消息                     |
| 微信     | 企业消息                                 |
| 邮件     | 内置163、126、qq等类型自定义其他邮件类型 |
| 语音     | 阿里云语音                               |
| 短信     | 阿里云短信                               |
| webhook  | 自定义webhook地址                        |



## 通知配置

### 新增配置

<p>1.<b>登录</b>Jetlinks物联网平台。<br>
2.在左侧导航栏，选择<b>通知管理>通知配置</b>，进入卡片页。</p>



![通知配置页面](./images/notification-page.png)

<p>3.点击<b>新增</b>按钮，在详情页中填写通知配置信息，然后点击<b>保存</b>。</p>

![新增通知配置详情](./images/notification-config-detail.png)



### 配置参数说明

#### 钉钉通知配置

| 参数      | 说明                                                         |
| --------- | ------------------------------------------------------------ |
| 名称      | 为通知模板命名，最多可输入64个字符                           |
| 类型      | 定义通知类型，根据类型的不同展示关联的配置参数项。现支持钉钉消息和群机器人消息。使用钉钉群机器人消息通知时需在钉钉开放平台中创建好对应的机器人，再到钉钉客户端对应的群中绑定智能机器人。 |
| AppKey    | 企业内部应用的唯一身份标识。在钉钉开发者后台创建企业内部应用后，系统会自动生成一对AppKey和AppSecret。获取路径：“钉钉开放平台”--“应用开发”--“应用信息” |
| AppSecret | 钉钉应用对应的调用密钥，获取路径：“钉钉开放平台”--“应用开发”--“应用信息” |
| 说明      | 通知配置备注说明信息，非必填。                               |



#### 微信通知配置

| 参数       | 说明                                                         |
| ---------- | ------------------------------------------------------------ |
| 名称       | 为通知模板名称，最多可输入64个字符。                         |
| 类型       | 定义通知类型，现只支持企业消息。                             |
| corpId     | 企业号的唯一专属编号。获取路径：“企业微信”管理后台--“我的企业”--“企业ID” |
| corpSecret | 应用的唯一secret,一个企业微信中可以有多个corpSecret。获取路径：“企业微信”--“应用与小程序”--“自建应用”中获取 |
| 说明       | 通知配置备注说明信息，非必填。                               |



#### 邮件通知配置

| 参数       | 说明                                                         |
| ---------- | ------------------------------------------------------------ |
| 名称       | 为通知模板命名，最多可输入64个字符                           |
| 服务器地址 | 下拉可选择国内常用的邮箱服务配置，也支持手动输入其他地址。系统使用POP协议。POP允许电子邮件客户端下载服务器上的邮件，但是您在电子邮件客户端的操作（如：移动邮件、标记已读等），这时不会反馈到服务器上。 |
| 发件人     | 用于发送邮件时“发件人“信息的显示                             |
| 用户名     | 登录邮箱时的账号，用该账号进行发送邮件。                     |
| 密码       | 在选择的对应邮箱页面设置中找到并开启POP3/SMTP服务，配置授权密码后填入。 |
| 说明       | 通知配置备注说明信息，非必填。                               |



#### 语音通知配置

| 参数        | 说明                                                         |
| ----------- | ------------------------------------------------------------ |
| 名称        | 为通知模板命名，最多可输入64个字符。                         |
| 类型        | 定义通知类型，现支持阿里云语音。                             |
| RegionId    | 阿里云服务地域与对应的RegionID。请根据购买的阿里云服务器地域进行选择。 |
| AccessKeyId | 用于程序通知方式调用云服务费API的用户标识和秘钥获取路径：“阿里云管理控制台”--“用户头像”--“”--“AccessKey管理”--“查看” |
| Secret      | 用于程序通知方式调用云服务费API的用户秘钥，获取路径：“阿里云管理控制台”--“用户头像”--“”--“AccessKey管理”--“查看”。 |
| 说明        | 通知配置备注说明信息，非必填。                               |



#### 短信通知配置

| 参数        | 说明                                                         |
| ----------- | ------------------------------------------------------------ |
| 名称        | 为通知模板命名，最多可输入64个字符。                         |
| 类型        | 定义通知类型，现支持阿里云语音。                             |
| RegionId    | 阿里云内部给每台机器设置的唯一编号。请根据购买的阿里云服务器地址进行填写。阿里云地域和可用区对照表地址：https://help.aliyun.com/document_detail/40654.html?spm=a2c6h.13066369.0.0.54a174710O7rWH |
| AccessKeyId | 用于程序通知方式调用云服务费API的用户标识和秘钥。获取路径：“阿里云管理控制台”--“用户头像”--“”--“AccessKey管理”--“查看” |
| Secret      | 用于程序通知方式调用云服务费API的用户秘钥，获取路径：“阿里云管理控制台”--“用户头像”--“”--“AccessKey管理”--“查看”。 |
| 说明        | 通知配置备注说明信息，非必填。                               |



#### Webhook通知配置

| 参数    | 说明                                                         |
| ------- | ------------------------------------------------------------ |
| 名称    | 为通知模板命名，最多可输入64个字符。                         |
| 类型    | 定义通知类型，现支持Webhook。                                |
| Webhook | Webhook地址。                                                |
| 请求头  | 支持根据系统提供的接口设置不同的请求头。如 Accept-Language 、Content-Type，非必填 |
| 说明    | 通知模板备注说明信息，非必填。                               |



### 编辑配置

<p>1.<b>登录</b>Jetlinks物联网平台。<br>
2.在左侧导航栏，选择<b>通知管理>通知配置</b>，进入卡片页。<br>
3.点击具体数据的<b>编辑</b>按钮，在详情页中编辑通知配置信息，然后点击<b>保存</b>。</p>



![编辑通知模板](./images/notification-edit-template.png)

<p>4.在详情页中编辑通知配置信息，然后点击<b>保存</b>。</p>



### 调试配置

<p>1.<b>登录</b>Jetlinks物联网平台。<br>
2.在左侧导航栏，选择<b>通知管理>通知配置</b>，进入卡片页。<br>
3.点击具体数据的<b>调试</b>按钮，在弹框中填写调试信息，然后点击<b>确定</b>。</p>



![调试模板](./images/notification-test-template.png)



### 删除配置

<p>1.<b>登录</b>Jetlinks物联网平台。<br>
2.在左侧导航栏，选择<b>通知管理>通知配置</b>，进入卡片页。<br>
3.点击具体数据的<b>删除</b>按钮，然后点击<b>确定</b>。</p>



![删除模板](./images/notification-delete-template.png)



### 同步用户

<div class='explanation primary'>
  <p class='explanation-title-warp'>
    <span class='iconfont icon-bangzhu explanation-icon'></span>
    <span class='explanation-title font-weight'>说明</span>
  </p>
    <p>
        当通知配置所选方式为<b>企业微信、钉钉消息</b>时，对应的配置卡片将出现<b>同步用户</b>按钮。该功能主要目的为将平台内的用户与钉钉、企业微信用户进行关联，实现在通知时通过选择平台内的用户、角色，即可将消息发送给关联的企业微信、钉钉用户。
    </p>
</div>



## 通知模板

### 新增模板

<p>1.<b>登录</b>Jetlinks物联网平台。<br>
2.在左侧导航栏，选择<b>通知管理>通知模板</b>，进入卡片页。</p>



![通知模板页面](./images/notification-template-page.png)

<p>3.点击<b>新增</b>按钮，在详情页中填写通知模板信息，然后点击<b>保存</b>。</p>

![新增邮件通知模板](./images/notification-template-email.png)



### 模板参数说明

#### 钉钉通知模板

| 参数     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 名称     | 为通知模板命名，最多可输入64个字符                           |
| 类型     | 定义通知类型，根据类型的不同展示关联的配置参数项。现支持钉钉消息和群机器人消息。使用钉钉群机器人消息通知时需在钉钉开放平台中创建好对应的机器人，再到钉钉客户端对应的群中绑定智能机器人。 |
| 绑定配置 | 使用固定的通知配置来发送此通知模版。                         |
| AgentID  | 应用唯一标识，获取路径：“钉钉开放平台”--“应用开发”--“查看应用”。 |
| 收信部门 | 定义用于接收此模板通知的部门，非必填。若此处不配置，则将在其他引用此模板的页面中进行配置，例如场景联动。 |
| 收信人   | 定义用于接收此模板通知的收信人，非必填。若此处不配置，则将在其他引用此模板的页面中进行配置，例如场景联动。 |
| 模板内容 | 定义通知模板的具体通知内容。支持填写带变量的动态模板。 变量填写规范示例：${name}。 填写动态参数后，可对变量的名称、类型、格式进行配置，以便调用该通知时进行填写。 |



#### 微信通知模板

| 参数     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 名称     | 为通知模板名称，最多可输入64个字符。                         |
| 类型     | 定义通知类型，现只支持企业消息。                             |
| 绑定配置 | 使用固定的通知配置来发送此通知模版。                         |
| AgentID  | 应用唯一标识，获取路径：“企业微信”管理后台--“应用管理”--“应用”--“查看应用”。 |
| 收信部门 | 定义用于接收此模板通知的部门，非必填。若此处不配置，则将在其他引用此模板的页面中进行配置，例如场景联动。 |
| 收信人   | 定义用于接收此模板通知的收信人，非必填。若此处不配置，则将在其他引用此模板的页面中进行配置，例如场景联动。 |
| 标签推送 | 定义用于接收此模板通知的标签用户，非必填。若此处不配置，则将在其他引用此模板的页面中进行配置，例如场景联动。 |
| 模板内容 | 定义通知模板的具体通知内容。支持填写带变量的动态模板。 变量填写规范示例：${name}。 填写动态参数后，可对变量的名称、类型、格式进行配置，以便调用该通知时进行填写。 |



#### 邮件通知模板

| 参数     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 名称     | 为通知模板命名，最多可输入64个字符                           |
| 标题     | 定义邮件标题，标题支持配置变量，变量填写规范示例：${name}。  |
| 收件人   | 填写收件人信息，多个收件人用换行分隔 最大支持1000个号码。非必填。若此处不配置，则将在其他引用此模板的页面中进行配置，例如场景联动。 |
| 附件信息 | 上传附件，附件只输入文件名称将在发送邮件时进行文件上传。     |
| 模板内容 | 定义通知模板的具体通知内容。支持填写带变量的动态模板。 变量填写规范示例：${name}。 填写动态参数后，可对变量的名称、类型、格式进行配置，以便调用该通知时进行填写。 |
| 说明     | 通知模板备注说明信息，非必填。                               |



#### 语音通知模板

| 参数     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 名称     | 为通知模板命名，最多可输入64个字符。                         |
| 类型     | 定义通知类型，现支持阿里云语音。                             |
| 绑定配置 | 使用固定的通知配置来发送此通知模版。                         |
| 类型     | 阿里云语音通知类型，当类型为验证码类型时可配置变量。         |
| 模板ID   | 阿里云内部分配的唯一ID标识。                                 |
| 被叫号码 | 填写被叫号码，仅支持中国大陆号码。                           |
| 被叫显号 | 必须是已购买的号码,用于呼叫号码显示。                        |
| 播放次数 | 语音文件的播放次数，最多可播放3次。                          |
| 模板内容 | 定义通知模板的具体通知内容。支持填写带变量的动态模板。 变量填写规范示例：${name}。 填写动态参数后，可对变量的名称、类型、格式进行配置，以便调用该通知时进行填写。 |
| 说明     | 通知模板备注说明信息，非必填。                               |



#### 短信通知模板

| 参数     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 名称     | 为通知模板命名，最多可输入64个字符。                         |
| 类型     | 定义通知类型，现支持阿里云短信。                             |
| 绑定配置 | 使用固定的通知配置来发送此通知模版。                         |
| 模板     | 阿里云短信平台自定义的模版名称。                             |
| 收信人   | 设置接收阿里云短信的收信人手机号，非必填，若此处不配置，则将在其他引用此模板的页面中进行配置，例如场景联动。 |
| 签名     | 用于短信内容签名信息显示，需在阿里云短信进行配置。           |
| 模板内容 | 定义通知模板的具体通知内容。支持填写带变量的动态模板。 变量填写规范示例：${name}。 填写动态参数后，可对变量的名称、类型、格式进行配置，以便调用该通知时进行填写。 |
| 说明     | 通知模板备注说明信息，非必填。                               |



#### Webhook通知模板

| 参数     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 名称     | 为通知模板命名，最多可输入64个字符。                         |
| 绑定配置 | 使用固定的通知配置来发送此通知模版。                         |
| 请求体   | 选择默认，请求体中的数据来自于发送通知时指定的所有变量；选择自定义，可自定义编辑请求体内容，使用webhook通知时，系统会将该事件通过您指定的URL地址，以POST方式发送。 |
| 说明     | 通知模板备注说明信息，非必填。                               |



### 编辑模板

<p>1.<b>登录</b>Jetlinks物联网平台。<br>
2.在左侧导航栏，选择<b>通知管理>通知模板</b>，进入卡片页。<br>
3.点击具体数据的<b>编辑</b>按钮，在详情页中编辑通知模板信息，然后点击<b>保存</b>。</p>



![编辑通知模板](./images/notification-template-dingtalk.png)

<p>4.在详情页中编辑通知模板/通知配置信息，然后点击<b>保存</b>。</p>



### 调试模板

<p>1.<b>登录</b>Jetlinks物联网平台。<br>
2.在左侧导航栏，选择<b>通知管理>通知模板</b>，进入卡片页。<br>
3.点击具体数据的<b>调试</b>按钮，在弹框中填写调试信息，然后点击<b>确定</b>。</p>



![调试模板](./images/notification-template-debug.png)



### 删除模板

<p>1.<b>登录</b>Jetlinks物联网平台。<br>
2.在左侧导航栏，选择<b>通知管理>通知模板</b>，进入卡片页。<br>
3.点击具体数据的<b>删除</b>按钮，然后点击<b>确定</b>。</p>



![删除模板](./images/notification-template-delete.png)



### 通知记录

<p>1.<b>登录</b>Jetlinks物联网平台。<br>
2.在左侧导航栏，选择<b>通知管理>通知模板</b>，进入卡片页。<br>
3.点击具体数据的<b>通知记录</b>按钮。</p>


![通知记录](./images/notification-history.png)